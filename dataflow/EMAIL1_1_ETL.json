{
	"name": "EMAIL1_1_ETL",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "Dim_Email_1_1_Parquet",
						"type": "DatasetReference"
					},
					"name": "dInteracaoVisitasRealizadas"
				},
				{
					"dataset": {
						"referenceName": "Dim_Email_1_1_Parquet",
						"type": "DatasetReference"
					},
					"name": "dInteracaoVisitasMedicos"
				},
				{
					"dataset": {
						"referenceName": "Dim_Email_1_1_Parquet",
						"type": "DatasetReference"
					},
					"name": "dInteracaoEmail"
				},
				{
					"dataset": {
						"referenceName": "Dim_Email_1_1_Parquet",
						"type": "DatasetReference"
					},
					"name": "dInteracaoVisitasFranchise"
				},
				{
					"dataset": {
						"referenceName": "Dim_Email_1_1_Parquet",
						"type": "DatasetReference"
					},
					"name": "chaveQuadgpPainelInteracao"
				}
			],
			"sinks": [],
			"transformations": [
				{
					"name": "VisRealizadastoVisMedicos"
				},
				{
					"name": "Uniao1toEmail"
				},
				{
					"name": "Uniao2toVisFranchise"
				},
				{
					"name": "KEYintquadgppainel"
				},
				{
					"name": "Chaveamento"
				},
				{
					"name": "KEYintquadgppainelFinal"
				},
				{
					"name": "LeftJoinChave"
				},
				{
					"name": "Sort1"
				}
			],
			"script": "source(output(\n\t\tID as string,\n\t\tID_VISITA as string,\n\t\tTIPO_VISITA as string,\n\t\tTIPO_VISITA_PTBR as string,\n\t\tTIPO_VISITA_ORDER as string,\n\t\tCLM_IND as string,\n\t\tRECORD_TYPE_ID as string,\n\t\tRECORD_TYPE_NAME as string,\n\t\tDATA as string,\n\t\tCICLO as string,\n\t\tTARGET_PER_ID as string,\n\t\tROW_ID_TERRITORIO as string,\n\t\tSEMANA as string,\n\t\tFLAG_VISITA as string,\n\t\tTIPO_INTERACAO as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet',\n\twildcardPaths:['synapse/workspaces/gsk-synapse/warehouse/dash.email1to1/dim_interacao_visitas_realizadas.parquet'],\n\tpartitionBy('hash', 1)) ~> dInteracaoVisitasRealizadas\nsource(output(\n\t\tID as string,\n\t\tCICLO as string,\n\t\tROW_ID_TERRITORIO as string,\n\t\tROW_ID_CONTATO as string,\n\t\tVP as string,\n\t\tVR as string,\n\t\tVRE as string,\n\t\tVRT as string,\n\t\tPLANEJUN as string,\n\t\tREALUN as string,\n\t\tEFFECTIVE_CALLS as string,\n\t\tUNDER_CALLS as string,\n\t\tOVER_CALLS as string,\n\t\tOFF_TARGET_CALLS as string,\n\t\tTARGET_CUST as string,\n\t\tUNDER_TARGET as string,\n\t\tON_TARGET as string,\n\t\tOVER_TARGET as string,\n\t\tEMAIL_CONSENT_KPI as string,\n\t\tAT_DESIRED_FREQUENCY as string,\n\t\tOVER_DESIRED_FREQUENCY as string,\n\t\tTIPO_INTERACAO as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet',\n\twildcardPaths:['synapse/workspaces/gsk-synapse/warehouse/dash.email1to1/dim_interacao_visitas_medicos.parquet'],\n\tpartitionBy('hash', 1)) ~> dInteracaoVisitasMedicos\nsource(output(\n\t\tID as string,\n\t\tCICLO as string,\n\t\tID_ENVIO_EMAIL as string,\n\t\tID_ATIV_EMAIL as string,\n\t\tTIPO_ATIV_EMAIL as string,\n\t\tDATA_ATIV_EMAIL as string,\n\t\tPRODUTO as string,\n\t\tROW_ID_CONTATO as string,\n\t\tROW_ID_TERRITORIO as string,\n\t\tDOCUMENTO_EMAIL as string,\n\t\tDESC_DOCUMENTO_EMAIL as string,\n\t\tASSUNTO_EMAIL as string,\n\t\tTIPO_INTERACAO as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet',\n\twildcardPaths:['synapse/workspaces/gsk-synapse/warehouse/dash.email1to1/dim_interacao_email.parquet'],\n\tpartitionBy('hash', 1)) ~> dInteracaoEmail\nsource(output(\n\t\tID as string,\n\t\tROW_ID_CONTATO as string,\n\t\tROW_ID_TERRITORIO as string,\n\t\tCICLO as string,\n\t\tPRODUTO_FRANCHISE as string,\n\t\tFRANCHISE as string,\n\t\tSUB_CAT_FRANCHISE as string,\n\t\tPESO_FRANCHISE as string,\n\t\tTIPO_INTERACAO as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet',\n\twildcardPaths:['synapse/workspaces/gsk-synapse/warehouse/dash.email1to1/dim_interacao_visitas_franchise.parquet']) ~> dInteracaoVisitasFranchise\nsource(output(\n\t\tCRM_CICLO as string,\n\t\tMES as string,\n\t\tCICLO as string,\n\t\tCRM as string,\n\t\tMEDICO as string,\n\t\tTIPO as string,\n\t\tTIPOCONTATO as string,\n\t\tGRUPOPROMOCIONAL as string,\n\t\tESPECIALIDADE as string,\n\t\tLOGRADOURO as string,\n\t\tCOMPLEMENTO as string,\n\t\tBAIRRO as string,\n\t\tCIDADE as string,\n\t\tUF as string,\n\t\tCEP as string,\n\t\tBRICK as string,\n\t\tTELEFONEMEDICO as string,\n\t\tCELULARMEDICO as string,\n\t\tEMAIL_1_1 as string,\n\t\tROW_ID_FUNCIONARIO as string,\n\t\tROW_ID_TERRITORIO as string,\n\t\tROW_ID_CONTATO as string,\n\t\tSTATUS as string,\n\t\tQTD_VISITA_PLANEJADA_PAINEL as string,\n\t\tQTD_VISITA_REALIZADA_PAINEL as string,\n\t\tESPECIALIDADE_02 as string,\n\t\tESPECIALIDADE_03 as string,\n\t\tVP_PROX as string,\n\t\tSTATUS_MEDICO as string,\n\t\tEMAIL_1_1_CONSENT as string,\n\t\tNETWORK_ID as string,\n\t\tRX_GIGYA_ID as string,\n\t\tVEEVA_ID as string,\n\t\tROW_ID_CONTATO_EXT as string,\n\t\tEMAIL_MASS as string,\n\t\tEMAIL_MASS_CONSENT as string,\n\t\tCYCLE_PLAN as string,\n\t\tMERCADO as string,\n\t\tPRODUTO_PAINEL as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tlimit: 100,\n\tformat: 'parquet',\n\twildcardPaths:['synapse/workspaces/gsk-synapse/warehouse/dash.email1to1/dim_painel_medico.parquet'],\n\tpartitionBy('hash', 1)) ~> chaveQuadgpPainelInteracao\ndInteracaoVisitasRealizadas, dInteracaoVisitasMedicos union(byName: true,\n\tpartitionBy('hash', 1))~> VisRealizadastoVisMedicos\nVisRealizadastoVisMedicos, dInteracaoEmail union(byName: true,\n\tpartitionBy('hash', 1))~> Uniao1toEmail\nUniao1toEmail, dInteracaoVisitasFranchise union(byName: true,\n\tpartitionBy('hash', 1))~> Uniao2toVisFranchise\nchaveQuadgpPainelInteracao keyGenerate(output(KEY_TERR_CONT_CICLO as long),\n\tstartAt: 1L,\n\tpartitionBy('hash', 1)) ~> KEYintquadgppainel\nKEYintquadgppainel aggregate(groupBy(ROW_ID_TERRITORIO,\n\t\tROW_ID_CONTATO,\n\t\tCICLO),\n\tKEY_TERR_CONT_CICLO = sum(0),\n\tpartitionBy('hash', 1)) ~> Chaveamento\nChaveamento keyGenerate(output(KEY_TERR_CONT_CICLO as long),\n\tstartAt: 1L,\n\tpartitionBy('hash', 1)) ~> KEYintquadgppainelFinal\nUniao2toVisFranchise, KEYintquadgppainelFinal join(Uniao2toVisFranchise@ROW_ID_TERRITORIO == Chaveamento@ROW_ID_TERRITORIO\n\t&& Uniao2toVisFranchise@ROW_ID_CONTATO == Chaveamento@ROW_ID_CONTATO\n\t&& Uniao2toVisFranchise@CICLO == Chaveamento@CICLO,\n\tjoinType:'left',\n\tpartitionBy('hash', 1),\n\tbroadcast: 'auto')~> LeftJoinChave\nLeftJoinChave sort(asc(Chaveamento@CICLO, false),\n\tasc(Chaveamento@ROW_ID_CONTATO, false)) ~> Sort1"
		}
	}
}