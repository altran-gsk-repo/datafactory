{
	"name": "EMAIL_ETL",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "Dim_Email_1_1_Parquet",
						"type": "DatasetReference"
					},
					"name": "dIntVisitasRealizadas"
				},
				{
					"dataset": {
						"referenceName": "Dim_Email_1_1_Parquet",
						"type": "DatasetReference"
					},
					"name": "dIntVisitasMedico"
				},
				{
					"dataset": {
						"referenceName": "Dim_Email_1_1_Parquet",
						"type": "DatasetReference"
					},
					"name": "dIntEmail"
				},
				{
					"dataset": {
						"referenceName": "Dim_Email_1_1_Parquet",
						"type": "DatasetReference"
					},
					"name": "dIntVisitasFranchise"
				},
				{
					"name": "source3"
				},
				{
					"linkedService": {
						"referenceName": "AzureBlobStorageSynapse",
						"type": "LinkedServiceReference"
					},
					"name": "HistZona"
				}
			],
			"sinks": [],
			"transformations": [
				{
					"name": "RemoveColumnsID",
					"description": "Autogenerated by data preview actions"
				},
				{
					"name": "ConcatChave"
				},
				{
					"name": "ConcatChave2"
				},
				{
					"name": "RemoveColumnsID2",
					"description": "Autogenerated by data preview actions"
				},
				{
					"name": "ConcatChave3"
				},
				{
					"name": "RemoveColumnsID3",
					"description": "Autogenerated by data preview actions"
				},
				{
					"name": "ConcatChave4"
				},
				{
					"name": "RemoveColumnsID4",
					"description": "Autogenerated by data preview actions"
				},
				{
					"name": "UnpivotHistZona"
				},
				{
					"name": "SelecaoTempHistZona"
				},
				{
					"name": "DerivedColumn1"
				}
			],
			"script": "source(output(\n\t\tID as string,\n\t\tID_VISITA as string,\n\t\tTIPO_VISITA as string,\n\t\tTIPO_VISITA_PTBR as string,\n\t\tTIPO_VISITA_ORDER as string,\n\t\tCLM_IND as string,\n\t\tRECORD_TYPE_ID as string,\n\t\tRECORD_TYPE_NAME as string,\n\t\tDATA as string,\n\t\tCICLO as string,\n\t\tTARGET_PER_ID as string,\n\t\tROW_ID_TERRITORIO as string,\n\t\tSEMANA as string,\n\t\tFLAG_VISITA as string,\n\t\tTIPO_INTERACAO as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet',\n\twildcardPaths:['synapse/workspaces/gsk-synapse/warehouse/dash.email1to1/dim_interacao_visitas_realizadas.parquet'],\n\tpartitionBy('hash', 1)) ~> dIntVisitasRealizadas\nsource(output(\n\t\tID as string,\n\t\tCICLO as string,\n\t\tROW_ID_TERRITORIO as string,\n\t\tROW_ID_CONTATO as string,\n\t\tVP as string,\n\t\tVR as string,\n\t\tVRE as string,\n\t\tVRT as string,\n\t\tPLANEJUN as string,\n\t\tREALUN as string,\n\t\tEFFECTIVE_CALLS as string,\n\t\tUNDER_CALLS as string,\n\t\tOVER_CALLS as string,\n\t\tOFF_TARGET_CALLS as string,\n\t\tTARGET_CUST as string,\n\t\tUNDER_TARGET as string,\n\t\tON_TARGET as string,\n\t\tOVER_TARGET as string,\n\t\tEMAIL_CONSENT_KPI as string,\n\t\tAT_DESIRED_FREQUENCY as string,\n\t\tOVER_DESIRED_FREQUENCY as string,\n\t\tTIPO_INTERACAO as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet',\n\twildcardPaths:['synapse/workspaces/gsk-synapse/warehouse/dash.email1to1/dim_interacao_visitas_medicos.parquet']) ~> dIntVisitasMedico\nsource(output(\n\t\tID as string,\n\t\tCICLO as string,\n\t\tID_ENVIO_EMAIL as string,\n\t\tID_ATIV_EMAIL as string,\n\t\tTIPO_ATIV_EMAIL as string,\n\t\tDATA_ATIV_EMAIL as string,\n\t\tPRODUTO as string,\n\t\tROW_ID_CONTATO as string,\n\t\tROW_ID_TERRITORIO as string,\n\t\tDOCUMENTO_EMAIL as string,\n\t\tDESC_DOCUMENTO_EMAIL as string,\n\t\tASSUNTO_EMAIL as string,\n\t\tTIPO_INTERACAO as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet',\n\twildcardPaths:['synapse/workspaces/gsk-synapse/warehouse/dash.email1to1/dim_interacao_email.parquet']) ~> dIntEmail\nsource(output(\n\t\tID as string,\n\t\tROW_ID_CONTATO as string,\n\t\tROW_ID_TERRITORIO as string,\n\t\tCICLO as string,\n\t\tPRODUTO_FRANCHISE as string,\n\t\tFRANCHISE as string,\n\t\tSUB_CAT_FRANCHISE as string,\n\t\tPESO_FRANCHISE as string,\n\t\tTIPO_INTERACAO as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet',\n\twildcardPaths:['synapse/workspaces/gsk-synapse/warehouse/dash.email1to1/dim_interacao_visitas_franchise.parquet']) ~> dIntVisitasFranchise\nsource(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> source3\nsource(output(\n\t\tUF as string,\n\t\t{Cidade Base} as string,\n\t\tCHAVE as string,\n\t\tTotal_Reps_OneFarma as short,\n\t\t{2020-05-26} as string,\n\t\t{2020-05-29} as string,\n\t\t{2020-06-01} as string,\n\t\t{2020-06-02} as string,\n\t\t{2020-06-03} as string,\n\t\t{2020-06-08} as string,\n\t\t{2020-06-09} as string,\n\t\t{2020-06-10} as string,\n\t\t{2020-06-11} as string,\n\t\t{2020-06-15} as string,\n\t\t{2020-06-17} as string,\n\t\t{2020-06-18} as string,\n\t\t{2020-06-19} as string,\n\t\t{2020-06-22} as string,\n\t\t{2020-06-24} as string,\n\t\t{2020-06-25} as string,\n\t\t{2020-06-26} as string,\n\t\t{2020-06-29} as string,\n\t\t{2020-06-30} as string,\n\t\t{2020-07-01} as string,\n\t\t{2020-07-06} as string,\n\t\t{2020-07-07} as string,\n\t\t{2020-07-10} as string,\n\t\t{2020-07-13} as string,\n\t\t{2020-07-14} as string,\n\t\t{2020-07-15} as string,\n\t\t{2020-07-20} as string,\n\t\t{2020-07-21} as string,\n\t\t{2020-07-27} as string,\n\t\t{2020-07-28} as string,\n\t\t{2020-08-04} as string,\n\t\t{2020-08-05} as string,\n\t\t{2020-08-06} as string,\n\t\t{2020-08-07} as string,\n\t\t{2020-08-10} as string,\n\t\t{2020-08-11} as string,\n\t\t{2020-09-04} as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tinferDriftedColumnTypes: true,\n\tformat: 'excel',\n\tcontainer: 'gsksynapsestorage',\n\tfolderPath: 'synapse/workspaces/gsk-synapse/warehouse/aux.tabelas_auxiliares',\n\tfileName: 'BASE CIDADES REPS - 04_09_2020.xlsx',\n\tsheetName: 'ZONAS CIDADES - HISTORICO',\n\tfirstRowAsHeader: true,\n\tpartitionBy('hash', 1)) ~> HistZona\nConcatChave select(mapColumn(\n\t\tKEY_TERR_CONT_CICLO_NAME = KEY_TERR_CONT_CICLO,\n\t\tID_VISITA,\n\t\tTIPO_VISITA,\n\t\tTIPO_VISITA_PTBR,\n\t\tTIPO_VISITA_ORDER,\n\t\tCLM_IND,\n\t\tRECORD_TYPE_ID,\n\t\tRECORD_TYPE_NAME,\n\t\tDATA,\n\t\tCICLO,\n\t\tTARGET_PER_ID,\n\t\tROW_ID_TERRITORIO,\n\t\tSEMANA,\n\t\tFLAG_VISITA,\n\t\tTIPO_INTERACAO\n\t),\n\tpartitionBy('hash', 1),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> RemoveColumnsID\ndIntVisitasRealizadas derive(KEY_TERR_CONT_CICLO = concat(ROW_ID_TERRITORIO, TARGET_PER_ID, CICLO),\n\tpartitionBy('hash', 1)) ~> ConcatChave\ndIntVisitasMedico derive(KEY_TERR_CONT_CICLO = concat(ROW_ID_TERRITORIO,ROW_ID_CONTATO,CICLO)) ~> ConcatChave2\nConcatChave2 select(mapColumn(\n\t\tKEY_TERR_CONT_CICLO,\n\t\tCICLO,\n\t\tROW_ID_TERRITORIO,\n\t\tROW_ID_CONTATO,\n\t\tVP,\n\t\tVR,\n\t\tVRE,\n\t\tVRT,\n\t\tPLANEJUN,\n\t\tREALUN,\n\t\tEFFECTIVE_CALLS,\n\t\tUNDER_CALLS,\n\t\tOVER_CALLS,\n\t\tOFF_TARGET_CALLS,\n\t\tTARGET_CUST,\n\t\tUNDER_TARGET,\n\t\tON_TARGET,\n\t\tOVER_TARGET,\n\t\tEMAIL_CONSENT_KPI,\n\t\tAT_DESIRED_FREQUENCY,\n\t\tOVER_DESIRED_FREQUENCY,\n\t\tTIPO_INTERACAO\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> RemoveColumnsID2\ndIntEmail derive(KEY_TERR_CONT_CICLO = concat(ROW_ID_TERRITORIO,ROW_ID_CONTATO,CICLO)) ~> ConcatChave3\nConcatChave3 select(mapColumn(\n\t\tKEY_TERR_CONT_CICLO,\n\t\tCICLO,\n\t\tID_ENVIO_EMAIL,\n\t\tID_ATIV_EMAIL,\n\t\tTIPO_ATIV_EMAIL,\n\t\tDATA_ATIV_EMAIL,\n\t\tPRODUTO,\n\t\tROW_ID_CONTATO,\n\t\tROW_ID_TERRITORIO,\n\t\tDOCUMENTO_EMAIL,\n\t\tDESC_DOCUMENTO_EMAIL,\n\t\tASSUNTO_EMAIL,\n\t\tTIPO_INTERACAO\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> RemoveColumnsID3\ndIntVisitasFranchise derive(KEY_TERR_CONT_CICLO = concat(ROW_ID_TERRITORIO,ROW_ID_CONTATO,CICLO)) ~> ConcatChave4\nConcatChave4 select(mapColumn(\n\t\tKEY_TERR_CONT_CICLO,\n\t\tROW_ID_CONTATO,\n\t\tROW_ID_TERRITORIO,\n\t\tCICLO,\n\t\tPRODUTO_FRANCHISE,\n\t\tFRANCHISE,\n\t\tSUB_CAT_FRANCHISE,\n\t\tPESO_FRANCHISE,\n\t\tTIPO_INTERACAO\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> RemoveColumnsID4\nHistZona unpivot(output(\n\t\tDATA_ZONA as string,\n\t\t{2020-05-26} as string,\n\t\t{2020-05-29} as string,\n\t\t{2020-06-01} as string,\n\t\t{2020-06-02} as string,\n\t\t{2020-06-03} as string,\n\t\t{2020-06-08} as string,\n\t\t{2020-06-09} as string,\n\t\t{2020-06-10} as string,\n\t\t{2020-06-11} as string,\n\t\t{2020-06-15} as string,\n\t\t{2020-06-17} as string,\n\t\t{2020-06-18} as string,\n\t\t{2020-06-19} as string,\n\t\t{2020-06-22} as string,\n\t\t{2020-06-24} as string,\n\t\t{2020-06-25} as string,\n\t\t{2020-06-26} as string,\n\t\t{2020-06-29} as string,\n\t\t{2020-06-30} as string,\n\t\t{2020-07-01} as string,\n\t\t{2020-07-06} as string,\n\t\t{2020-07-07} as string,\n\t\t{2020-07-10} as string,\n\t\t{2020-07-13} as string,\n\t\t{2020-07-14} as string,\n\t\t{2020-07-15} as string,\n\t\t{2020-07-20} as string,\n\t\t{2020-07-21} as string,\n\t\t{2020-07-27} as string,\n\t\t{2020-07-28} as string,\n\t\t{2020-08-04} as string,\n\t\t{2020-08-05} as string,\n\t\t{2020-08-06} as string,\n\t\t{2020-08-07} as string,\n\t\t{2020-08-10} as string,\n\t\t{2020-08-11} as string,\n\t\t{2020-09-04} as string\n\t),\n\tungroupBy(UF,\n\t\t{Cidade Base},\n\t\tCHAVE,\n\t\tTotal_Reps_OneFarma),\n\tlateral: true,\n\tignoreNullPivots: true,\n\tpartitionBy('hash', 1)) ~> UnpivotHistZona\nUnpivotHistZona select(mapColumn(\n\t\tCHAVE_ZONA = CHAVE,\n\t\tDATA_ZONA,\n\t\tSTATUS_ZONA = {2020-05-26}\n\t),\n\tpartitionBy('hash', 1),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelecaoTempHistZona\nSelecaoTempHistZona derive(DATA_ZONA = toDate(DATA_ZONA)) ~> DerivedColumn1"
		}
	}
}